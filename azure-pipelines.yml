trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  resourceGroup: haneenweu
  containerAppName: acahaneen
  environmentName: managedEnvironment-haneenweu-8ec8
  location: westeurope
  imageName: nginx:latest

steps:
- task: AzureCLI@2
  inputs:
    azureSubscription: 'bdf668f2-07bd-4c3b-bc66-c364bf7accb1'
    scriptType: bash
    scriptLocation: inlineScript
    inlineScript: |
      # Create Container App if it doesn't exist
      az containerapp create \
        --name ${{ variables.containerAppName }} \
        --resource-group ${{ variables.resourceGroup }} \
        --environment ${{ variables.environmentName }} \
        --image ${{ variables.imageName }} \
        --target-port 80 \
        --ingress 'external' \
        --revision-suffix nginxv1 \
        --query-properties configuration.ingress.external=true \
        --transport http
    displayName: 'Deploy Nginx to Azure Container Apps'
